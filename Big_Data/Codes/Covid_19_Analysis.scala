>>> covid_data = spark.read.option("header","true").option("inferSchema","true").csv("data.csv")
>>> covid_data.show()
+--------------------+-------------------+----------+---------+----------+---------+------+---------+------+--------------------+-------------+-------------------+
|            province|            country|      date|      lat|      long|confirmed|deaths|recovered|active|        Combined_Key|Incident_Rate|Case_Fatality_Ratio|
+--------------------+-------------------+----------+---------+----------+---------+------+---------+------+--------------------+-------------+-------------------+
|                null|        Afghanistan|04-01-2021| 33.93911| 67.709953|    52709|  2221|    41727|    90|         Afghanistan|  0.806610279|        4.252222179|
|                null|            Albania|04-01-2021|  41.1533|   20.1683|    59438|  1193|    34648| 23597|             Albania|  2065.397178|        2.007133484|
|                null|            Algeria|04-01-2021|  28.0339|    1.6596|   100408|  2772|    67808| 29828|             Algeria|  228.9751694|        2.760736196|
|                null|            Andorra|04-01-2021|  42.5063|    1.5218|     8192|    84|     7517|   591|             Andorra|  10602.47201|        1.025390625|
|                null|             Angola|04-01-2021| -11.2027|   17.8739|    17642|   408|    11223|  6011|              Angola|  53.67813589|        2.312662963|
|                null|Antigua and Barbuda|04-01-2021|  17.0608|  -61.7964|      160|     5|      148|     7| Antigua and Barbuda|  163.3853443|              3.125|
|                null|          Argentina|04-01-2021| -38.4161|  -63.6167|  1640718| 43482|  1452960|144276|           Argentina|  3630.246251|        2.650181201|
|                null|            Armenia|04-01-2021|  40.0691|   45.0382|   160027|  2850|   144091| 13086|             Armenia|  5400.417247|        1.780949465|
|Australian Capita...|          Australia|04-01-2021| -35.4735|  149.0124|      118|     3|      114|     1|Australian Capita...|  27.56365335|        2.542372881|
|     New South Wales|          Australia|04-01-2021| -33.8688|  151.2093|     4965|    54|        0|  1714|New South Wales, ...|  61.16038433|        1.087613293|
|  Northern Territory|          Australia|04-01-2021| -12.4634|  130.8456|       81|     0|       70|    11|Northern Territor...|  32.98045603|                0.0|
|          Queensland|          Australia|04-01-2021| -27.4698|  153.0251|     1260|     6|     1232|    22|Queensland, Austr...|  24.63102336|        0.476190476|
|     South Australia|          Australia|04-01-2021| -34.9285|  138.6007|      583|     4|      566|    13|South Australia, ...|  33.19100484|        0.686106346|
|            Tasmania|          Australia|04-01-2021| -42.8821|  147.3272|      234|    13|      221|     0| Tasmania, Australia|  43.69747899|        5.555555556|
|            Victoria|          Australia|04-01-2021| -37.8136|  144.9631|    20395|   820|    19539|    36| Victoria, Australia|  307.6215328|        4.020593283|
|   Western Australia|          Australia|04-01-2021| -31.9505|  115.8605|      868|     9|      839|    20|Western Australia...|  32.99627461|        1.036866359|
|                null|            Austria|04-01-2021|  47.5162|   14.5501|   365768|  6324|   338831| 20613|             Austria|  4061.200924|        1.728964808|
|                null|         Azerbaijan|04-01-2021|  40.1431|   47.5769|   220265|  2733|   194843| 22689|          Azerbaijan|  2172.415409|        1.240778154|
|                null|            Bahamas|04-01-2021|25.025885|-78.035889|     7914|   175|     6239|  1500|             Bahamas|  2012.470502|        2.211271165|
|                null|            Bahrain|04-01-2021|  26.0275|     50.55|    93478|   352|    90686|  2440|             Bahrain|   5493.59038|         0.37655919|
+--------------------+-------------------+----------+---------+----------+---------+------+---------+------+--------------------+-------------+-------------------+
only showing top 20 rows

>>> from pyspark.sql.types import*
>>> covid_data.printSchema()
root
 |-- province: string (nullable = true)
 |-- country: string (nullable = true)
 |-- date: string (nullable = true)
 |-- lat: double (nullable = true)
 |-- long: double (nullable = true)
 |-- confirmed: integer (nullable = true)
 |-- deaths: integer (nullable = true)
 |-- recovered: integer (nullable = true)
 |-- active: integer (nullable = true)
 |-- Combined_Key: string (nullable = true)
 |-- Incident_Rate: double (nullable = true)
 |-- Case_Fatality_Ratio: double (nullable = true)


>>> country = covid_data.groupBy("country")
>>> country_sum=country.agg({'confirmed':'sum'})
>>> country_sum.show()
+-----------+--------------+
|    country|sum(confirmed)|
+-----------+--------------+
|       Chad|          2213|
|   Paraguay|        109073|
|     Russia|       3203743|
|      Yemen|          2101|
|    Senegal|         19697|
| Cabo Verde|         11920|
|     Sweden|        437379|
|   Kiribati|             0|
|     Guyana|          6358|
|      Burma|        126345|
|    Eritrea|          1320|
|Philippines|        477807|
|   Djibouti|          5842|
|      Tonga|             0|
|  Singapore|         58697|
|   Malaysia|        119077|
|       Fiji|            49|
|     Turkey|       2241912|
|     Malawi|          6844|
|       Iraq|        597774|
+-----------+--------------+
only showing top 20 rows

>>> country_sum=country.agg(sum("confirmed").alias("total_confirmed"))
>>> country_sum.sort(col("total_confirmed").desc()).show()
+--------------+---------------+
|       country|total_confirmed|
+--------------+---------------+
|            US|       20826215|
|         India|       10340469|
|        Brazil|        7733746|
|        Russia|        3203743|
|        France|        2712975|
|United Kingdom|        2662703|
|        Turkey|        2241912|
|         Italy|        2155446|
|         Spain|        1928265|
|       Germany|        1783896|
|      Colombia|        1675820|
|     Argentina|        1640718|
|        Mexico|        1448755|
|        Poland|        1318562|
|          Iran|        1243434|
|       Ukraine|        1107137|
|  South Africa|        1100748|
|          Peru|        1018099|
|   Netherlands|         832702|
|     Indonesia|         765350|
+--------------+---------------+
only showing top 20 rows

>>> country_sum=country.agg(sum("deaths").alias("total_deaths"))
>>> country_sum.sort(col("total_deaths").desc()).show()
+--------------+------------+
|       country|total_deaths|
+--------------+------------+
|            US|      357984|
|        Brazil|      196018|
|         India|      149649|
|        Mexico|      127213|
|          Peru|       93575|
|         Italy|       75332|
|United Kingdom|       75137|
|        France|       65163|
|        Russia|       57730|
|          Iran|       55540|
|         Spain|       50837|
|      Colombia|       43965|
|     Argentina|       43482|
|       Germany|       34791|
|  South Africa|       29577|
|        Poland|       29119|
|     Indonesia|       22734|
|        Turkey|       21488|
|       Belgium|       19701|
|       Ukraine|       19630|
+--------------+------------+
only showing top 20 rows


>>> country_sum=country.agg(sum("active").alias("total_active"))
>>> country_sum.sort(col("total_active").desc()).show()
+--------------+------------+
|       country|total_active|
+--------------+------------+
|            US|    20285083|
|United Kingdom|     2581468|
|        France|     2446503|
|         Spain|     1727052|
|   Netherlands|      811076|
|        Brazil|      633556|
|       Belgium|      630310|
|         Italy|      576214|
|        Russia|      554076|
|        Sweden|      428652|
|        Serbia|      340545|
|       Ukraine|      331697|
|       Germany|      326954|
|         India|      243953|
|        Poland|      226350|
|        Mexico|      223111|
|          Iran|      174876|
|  South Africa|      167492|
|       Hungary|      149730|
|     Argentina|      144276|
+--------------+------------+
only showing top 20 rows

>>> country_sum=country.agg(sum("recovered").alias("total_recovered"))
>>> country_sum.sort(col("total_recovered").desc()).show()
+------------+---------------+
|     country|total_recovered|
+------------+---------------+
|       India|        9946867|
|      Brazil|        6904172|
|      Russia|        2591937|
|      Turkey|        2136534|
|    Colombia|        1542353|
|       Italy|        1503900|
|   Argentina|        1452960|
|     Germany|        1422151|
|      Mexico|        1098431|
|      Poland|        1063093|
|        Iran|        1013018|
|        Peru|         958682|
|South Africa|         903679|
|     Ukraine|         755810|
|   Indonesia|         631937|
|     Czechia|         612214|
|       Chile|         584457|
|     Romania|         574897|
|        Iraq|         543720|
|      Canada|         510595|
+------------+---------------+
only showing top 20 rows

>>> total_data = country.agg( sum("confirmed").alias("total_confirmed"),sum("deaths").alias("total_deaths"),sum("active").alias("total_active") , sum("recovered").alias("total_recovered"))
>>> total_data.sort(col("total_confirmed").desc()).show()
+--------------+---------------+------------+------------+---------------+
|       country|total_confirmed|total_deaths|total_active|total_recovered|
+--------------+---------------+------------+------------+---------------+
|            US|       20826215|      357984|    20285083|              0|
|         India|       10340469|      149649|      243953|        9946867|
|        Brazil|        7733746|      196018|      633556|        6904172|
|        Russia|        3203743|       57730|      554076|        2591937|
|        France|        2712975|       65163|     2446503|         201308|
|United Kingdom|        2662703|       75137|     2581468|           6097|
|        Turkey|        2241912|       21488|       83890|        2136534|
|         Italy|        2155446|       75332|      576214|        1503900|
|         Spain|        1928265|       50837|     1727052|         150376|
|       Germany|        1783896|       34791|      326954|        1422151|
|      Colombia|        1675820|       43965|       89502|        1542353|
|     Argentina|        1640718|       43482|      144276|        1452960|
|        Mexico|        1448755|      127213|      223111|        1098431|
|        Poland|        1318562|       29119|      226350|        1063093|
|          Iran|        1243434|       55540|      174876|        1013018|
|       Ukraine|        1107137|       19630|      331697|         755810|
|  South Africa|        1100748|       29577|      167492|         903679|
|          Peru|        1018099|       93575|       21644|         958682|
|   Netherlands|         832702|       11707|      811076|           9919|
|     Indonesia|         765350|       22734|      110679|         631937|
+--------------+---------------+------------+------------+---------------+
only showing top 20 rows

>>> total_data = total_data.withColumn('confirmed_percent', f.col('total_confirmed')/f.sum('total_confirmed').over(Window.partitionBy()))
>>> total_data.sort(col("total_confirmed").desc()).show()
21/11/17 11:31:48 WARN WindowExec: No Partition Defined for Window operation! Moving all data to a single partition, this can cause serious performance degradation.
+--------------+---------------+------------+------------+---------------+--------------------+
|       country|total_confirmed|total_deaths|total_active|total_recovered|             percent|
+--------------+---------------+------------+------------+---------------+--------------------+
|            US|       20826215|      357984|    20285083|              0| 0.24409495498114356|
|         India|       10340469|      149649|      243953|        9946867|  0.1211961134098976|
|        Brazil|        7733746|      196018|      633556|        6904172| 0.09064385351373733|
|        Russia|        3203743|       57730|      554076|        2591937| 0.03754967013238621|
|        France|        2712975|       65163|     2446503|         201308| 0.03179759310513062|
|United Kingdom|        2662703|       75137|     2581468|           6097|0.031208376986080085|
|        Turkey|        2241912|       21488|       83890|        2136534|0.026276469762349302|
|         Italy|        2155446|       75332|      576214|        1503900| 0.02526303960341742|
|         Spain|        1928265|       50837|     1727052|         150376| 0.02260035048935751|
|       Germany|        1783896|       34791|      326954|        1422151| 0.02090826459877813|
|      Colombia|        1675820|       43965|       89502|        1542353| 0.01964155308376966|
|     Argentina|        1640718|       43482|      144276|        1452960|0.019230137898161134|
|        Mexico|        1448755|      127213|      223111|        1098431|0.016980223554962176|
|        Poland|        1318562|       29119|      226350|        1063093|0.015454288358679031|
|          Iran|        1243434|       55540|      174876|        1013018|0.014573745937609078|
|       Ukraine|        1107137|       19630|      331697|         755810|0.012976268427698376|
|  South Africa|        1100748|       29577|      167492|         903679|0.012901385753752364|
|          Peru|        1018099|       93575|       21644|         958682|0.011932692981962745|
|   Netherlands|         832702|       11707|      811076|           9919|0.009759735852275998|
|     Indonesia|         765350|       22734|      110679|         631937|0.008970332525368543|
+--------------+---------------+------------+------------+---------------+--------------------+
only showing top 20 rows

>>> total_data = total_data.withColumn('confirmed_percent',f.col('confirmed_percent')*100)
>>> total_data.sort(col("confirmed_percent").desc()).show()
21/11/17 11:50:52 WARN WindowExec: No Partition Defined for Window operation! Moving all data to a single partition, this can cause serious performance degradation.
+--------------+---------------+------------+------------+---------------+------------------+
|       country|total_confirmed|total_deaths|total_active|total_recovered| confirmed_percent|
+--------------+---------------+------------+------------+---------------+------------------+
|            US|       20826215|      357984|    20285083|              0|24.409495498114357|
|         India|       10340469|      149649|      243953|        9946867| 12.11961134098976|
|        Brazil|        7733746|      196018|      633556|        6904172| 9.064385351373733|
|        Russia|        3203743|       57730|      554076|        2591937|3.7549670132386215|
|        France|        2712975|       65163|     2446503|         201308|3.1797593105130617|
|United Kingdom|        2662703|       75137|     2581468|           6097|3.1208376986080086|
|        Turkey|        2241912|       21488|       83890|        2136534|  2.62764697623493|
|         Italy|        2155446|       75332|      576214|        1503900| 2.526303960341742|
|         Spain|        1928265|       50837|     1727052|         150376|2.2600350489357512|
|       Germany|        1783896|       34791|      326954|        1422151| 2.090826459877813|
|      Colombia|        1675820|       43965|       89502|        1542353| 1.964155308376966|
|     Argentina|        1640718|       43482|      144276|        1452960|1.9230137898161133|
|        Mexico|        1448755|      127213|      223111|        1098431|1.6980223554962177|
|        Poland|        1318562|       29119|      226350|        1063093|1.5454288358679031|
|          Iran|        1243434|       55540|      174876|        1013018|1.4573745937609077|
|       Ukraine|        1107137|       19630|      331697|         755810|1.2976268427698376|
|  South Africa|        1100748|       29577|      167492|         903679|1.2901385753752364|
|          Peru|        1018099|       93575|       21644|         958682|1.1932692981962745|
|   Netherlands|         832702|       11707|      811076|           9919|0.9759735852275998|
|     Indonesia|         765350|       22734|      110679|         631937|0.8970332525368543|
+--------------+---------------+------------+------------+---------------+------------------+
only showing top 20 rows


>>> total_data = total_data.withColumn('deaths_percent', f.col('total_deaths')/f.sum('total_deaths').over(Window.partitionBy()))
>>> total_data = total_data.withColumn('deaths_percent',f.col('deaths_percent')*100)
>>> total_data.sort(col("deaths_percent").desc()).show()
21/11/17 12:06:25 WARN WindowExec: No Partition Defined for Window operation! Moving all data to a single partition, this can cause serious performance degradation.
21/11/17 12:06:25 WARN WindowExec: No Partition Defined for Window operation! Moving all data to a single partition, this can cause serious performance degradation.
+--------------+---------------+------------+------------+---------------+------------------+------------------+
|       country|total_confirmed|total_deaths|total_active|total_recovered| confirmed_percent|    deaths_percent|
+--------------+---------------+------------+------------+---------------+------------------+------------------+
|            US|       20826215|      357984|    20285083|              0|24.409495498114357|  18.7778533121837|
|        Brazil|        7733746|      196018|      633556|        6904172| 9.064385351373733|10.282016097221174|
|         India|       10340469|      149649|      243953|        9946867| 12.11961134098976| 7.849755772087519|
|        Mexico|        1448755|      127213|      223111|        1098431|1.6980223554962177| 6.672887764265512|
|          Peru|        1018099|       93575|       21644|         958682|1.1932692981962745| 4.908425023709411|
|         Italy|        2155446|       75332|      576214|        1503900| 2.526303960341742| 3.951498518686373|
|United Kingdom|        2662703|       75137|     2581468|           6097|3.1208376986080086|3.9412699012177823|
|        France|        2712975|       65163|     2446503|         201308|3.1797593105130617|3.4180892313115288|
|        Russia|        3203743|       57730|      554076|        2591937|3.7549670132386215|3.0281953151882908|
|          Iran|        1243434|       55540|      174876|        1013018|1.4573745937609077|2.9133200728487383|
|         Spain|        1928265|       50837|     1727052|         150376|2.2600350489357512|2.6666268012857635|
|      Colombia|        1675820|       43965|       89502|        1542353| 1.964155308376966|2.3061598308029305|
|     Argentina|        1640718|       43482|      144276|        1452960|1.9230137898161133| 2.280824332149961|
|       Germany|        1783896|       34791|      326954|        1422151| 2.090826459877813|1.8249427197421757|
|  South Africa|        1100748|       29577|      167492|         903679|1.2901385753752364| 1.551445224966639|
|        Poland|        1318562|       29119|      226350|        1063093|1.5454288358679031| 1.527421087527591|
|     Indonesia|         765350|       22734|      110679|         631937|0.8970332525368543|1.1924994334919554|
|        Turkey|        2241912|       21488|       83890|        2136534|  2.62764697623493|1.1271411905900914|
|       Belgium|         650011|       19701|      630310|              0|0.7618494564770799|1.0334050910189592|
|       Ukraine|        1107137|       19630|      331697|         755810|1.2976268427698376|1.0296808251714211|
+--------------+---------------+------------+------------+---------------+------------------+------------------+
only showing top 20 rows


>>> total_data = total_data.withColumn('active_percent', f.col('total_active')/f.sum('total_active').over(Window.partitionBy()))
>>> total_data = total_data.withColumn('active_percent',f.col('active_percent')*100)
>>> total_data.sort(col("active_percent").desc()).show()
+--------------+---------------+------------+------------+---------------+------------------+------------------+-------------------+
|       country|total_confirmed|total_deaths|total_active|total_recovered| confirmed_percent|    deaths_percent|     active_percent|
+--------------+---------------+------------+------------+---------------+------------------+------------------+-------------------+
|            US|       20826215|      357984|    20285083|              0|24.409495498114357|  18.7778533121837|  57.31903591160658|
|United Kingdom|        2662703|       75137|     2581468|           6097|3.1208376986080086|3.9412699012177823|  7.294387555459508|
|        France|        2712975|       65163|     2446503|         201308|3.1797593105130617|3.4180892313115288|  6.913020435501951|
|         Spain|        1928265|       50837|     1727052|         150376|2.2600350489357512|2.6666268012857635|  4.880086298350959|
|   Netherlands|         832702|       11707|      811076|           9919|0.9759735852275998|0.6140842292553147|  2.291836536781349|
|        Brazil|        7733746|      196018|      633556|        6904172| 9.064385351373733|10.282016097221174| 1.7902228507526354|
|       Belgium|         650011|       19701|      630310|              0|0.7618494564770799|1.0334050910189592| 1.7810507122620471|
|         Italy|        2155446|       75332|      576214|        1503900| 2.526303960341742| 3.951498518686373| 1.6281930401157576|
|        Russia|        3203743|       57730|      554076|        2591937|3.7549670132386215|3.0281953151882908| 1.5656382644211673|
|        Sweden|         437379|        8727|      428652|              0|0.5126327914827422|0.4577699725558325| 1.2112309021157066|
|        Serbia|         343870|        3325|      340545|              0|0.4030349834060862|0.1744110414516034|  0.962269224361471|
|       Ukraine|        1107137|       19630|      331697|         755810|1.2976268427698376|1.0296808251714211| 0.9372676589379579|
|       Germany|        1783896|       34791|      326954|        1422151| 2.090826459877813|1.8249427197421757|  0.923865486152727|
|         India|       10340469|      149649|      243953|        9946867| 12.11961134098976| 7.849755772087519| 0.6893317009225035|
|        Poland|        1318562|       29119|      226350|        1063093|1.5454288358679031| 1.527421087527591| 0.6395913577771483|
|        Mexico|        1448755|      127213|      223111|        1098431|1.6980223554962177| 6.672887764265512| 0.6304389990060408|
|          Iran|        1243434|       55540|      174876|        1013018|1.4573745937609077|2.9133200728487383|0.49414260341345967|
|  South Africa|        1100748|       29577|      167492|         903679|1.2901385753752364| 1.551445224966639|0.47327782503560917|
|       Hungary|         327995|        9884|      149730|         168381|0.3844285904041621|0.5184597695361348|0.42308819969062256|
|     Argentina|        1640718|       43482|      144276|        1452960|1.9230137898161133| 2.280824332149961| 0.4076769725410022|
+--------------+---------------+------------+------------+---------------+------------------+------------------+-------------------+
only showing top 20 rows



>>> total_data = total_data.withColumn('recovered_percent', f.col('total_recovered')/f.sum('total_recovered').over(Window.partitionBy()))
>>> total_data = total_data.withColumn('recovered_percent',f.col('recovered_percent')*100)
>>> total_data.sort(col("recovered_percent").desc()).show()
+------------+---------------+------------+------------+---------------+------------------+------------------+--------------------+------------------+
|     country|total_confirmed|total_deaths|total_active|total_recovered| confirmed_percent|    deaths_percent|      active_percent| recovered_percent|
+------------+---------------+------------+------------+---------------+------------------+------------------+--------------------+------------------+
|       India|       10340469|      149649|      243953|        9946867| 12.11961134098976| 7.849755772087519|  0.6893317009225035|20.773370751379545|
|      Brazil|        7733746|      196018|      633556|        6904172| 9.064385351373733|10.282016097221174|  1.7902228507526354| 14.41890443365671|
|      Russia|        3203743|       57730|      554076|        2591937|3.7549670132386215|3.0281953151882908|  1.5656382644211673|5.4130881879910975|
|      Turkey|        2241912|       21488|       83890|        2136534|  2.62764697623493|1.1271411905900914|  0.2370458096042632| 4.462009284423724|
|    Colombia|        1675820|       43965|       89502|        1542353| 1.964155308376966|2.3061598308029305|  0.2529034932793034|3.2211017497773415|
|       Italy|        2155446|       75332|      576214|        1503900| 2.526303960341742| 3.951498518686373|  1.6281930401157576| 3.140795214513243|
|   Argentina|        1640718|       43482|      144276|        1452960|1.9230137898161133| 2.280824332149961|  0.4076769725410022|3.0344104095213527|
|     Germany|        1783896|       34791|      326954|        1422151| 2.090826459877813|1.8249427197421757|   0.923865486152727| 2.970067860306685|
|      Mexico|        1448755|      127213|      223111|        1098431|1.6980223554962177| 6.672887764265512|  0.6304389990060408|2.2940001517873503|
|      Poland|        1318562|       29119|      226350|        1063093|1.5454288358679031| 1.527421087527591|  0.6395913577771483|2.2201990870287434|
|        Iran|        1243434|       55540|      174876|        1013018|1.4573745937609077|2.9133200728487383| 0.49414260341345967|2.1156207770568365|
|        Peru|        1018099|       93575|       21644|         958682|1.1932692981962745| 4.908425023709411|0.061158892634100286| 2.002143651732153|
|South Africa|        1100748|       29577|      167492|         903679|1.2901385753752364| 1.551445224966639| 0.47327782503560917|  1.88727354123021|
|     Ukraine|        1107137|       19630|      331697|         755810|1.2976268427698376|1.0296808251714211|  0.9372676589379579|1.5784589607562034|
|   Indonesia|         765350|       22734|      110679|         631937|0.8970332525368543|1.1924994334919554|  0.3127427960566247|1.3197584317267472|
|     Czechia|         740481|       11960|      116307|         612214|0.8678853856036353|0.6273552047402037| 0.32864569051904924|1.2785682568375627|
|       Chile|         618191|       16767|       16967|         584457|0.7245546265355857|0.8795037389530932| 0.04794321434682958|1.2205996068147924|
|     Romania|         640429|       15979|       49553|         574897|0.7506188134695564| 0.838169633490277|  0.1400206342033622|1.2006341820852582|
|        Iraq|         597774|       12834|       41220|         543720|0.7006247540366701|0.6732003927789108|  0.1164742909987809|1.1355230893245167|
|      Canada|         608734|       16006|       79602|         510595|0.7134704905595733|0.8395859036013127| 0.22492931858527307|   1.0663437280101|
+------------+---------------+------------+------------+---------------+------------------+------------------+--------------------+------------------+
only showing top 20 rows


>>> India = covid_data.filter(col('country') == 'India')
>>> India.show()
+--------------------+-------+----------+----------+----------+---------+------+---------+------+--------------------+-------------+-------------------+
|            province|country|      date|       lat|      long|confirmed|deaths|recovered|active|        Combined_Key|Incident_Rate|Case_Fatality_Ratio|
+--------------------+-------+----------+----------+----------+---------+------+---------+------+--------------------+-------------+-------------------+
|Andaman and Nicob...|  India|04-01-2021| 11.225999| 92.968178|     4948|    62|     4846|    40|Andaman and Nicob...|  1186.468314|        1.253031528|
|      Andhra Pradesh|  India|04-01-2021|   15.9129|     79.74|   883082|  7115|   872897|  3070|Andhra Pradesh, I...|  1638.267929|        0.805700943|
|   Arunachal Pradesh|  India|04-01-2021| 27.768456| 96.384277|    16732|    56|    16583|    93|Arunachal Pradesh...|   1065.42168|        0.334688023|
|               Assam|  India|04-01-2021| 26.357149| 92.830441|   216304|  1052|   212132|  3120|        Assam, India|  607.4753927|        0.486352541|
|               Bihar|  India|04-01-2021| 25.679658|  85.60484|   252857|  1405|   246979|  4473|        Bihar, India|  202.6098958|        0.555650031|
|          Chandigarh|  India|04-01-2021| 30.733839| 76.768278|    19881|   320|    19280|   281|   Chandigarh, India|  1716.138399|        1.609576983|
|        Chhattisgarh|  India|04-01-2021| 21.264705| 82.035366|   282368|  3400|   268988|  9980| Chhattisgarh, India|  959.2532414|        1.204102448|
|Dadra and Nagar H...|  India|04-01-2021| 20.194742| 73.080901|     3379|     2|     3368|     9|Dadra and Nagar H...|  548.7848452|        0.059189109|
|               Delhi|  India|04-01-2021| 28.646519|  77.10898|   626872| 10585|   611243|  5044|        Delhi, India|  3350.299894|        1.688542478|
|                 Goa|  India|04-01-2021| 15.359682| 74.057396|    51295|   741|    49653|   901|          Goa, India|  3233.727344|        1.444585242|
|             Gujarat|  India|04-01-2021| 22.694884| 71.590923|   247228|  4318|   233660|  9250|      Gujarat, India|  387.0654678|        1.746565923|
|             Haryana|  India|04-01-2021|  29.20004| 76.332824|   263068|  2917|   257261|  2890|      Haryana, India|  932.7100611|        1.108838779|
|    Himachal Pradesh|  India|04-01-2021| 31.927213| 77.233081|    55686|   944|    52912|  1830|Himachal Pradesh,...|  747.2669924|        1.695219624|
|   Jammu and Kashmir|  India|04-01-2021|  33.75943| 76.612638|   121653|  1886|   116792|  2975|Jammu and Kashmir...|  894.0918632|        1.550311131|
|           Jharkhand|  India|04-01-2021| 23.654536| 85.557631|   115529|  1035|   112893|  1601|    Jharkhand, India|   299.344861|        0.895878957|
|           Karnataka|  India|04-01-2021|  14.70518| 76.166436|   921938| 12107|   898919| 10912|    Karnataka, India|  1364.566826|        1.313211951|
|              Kerala|  India|04-01-2021| 10.450898| 76.405749|   775852|  3141|   707244| 65467|       Kerala, India|   2173.28881|        0.404845254|
|              Ladakh|  India|04-01-2021|   34.1526|   77.5771|     9556|   127|     9173|   256|       Ladakh, India|  3483.916599|        1.329007953|
|         Lakshadweep|  India|04-01-2021|13.6999972|72.1833326|        0|     0|        0|     0|  Lakshadweep, India|          0.0|               null|
|      Madhya Pradesh|  India|04-01-2021| 23.541513| 78.289633|   244026|  3641|   231533|  8852|Madhya Pradesh, I...|   285.882098|        1.492054125|
+--------------------+-------+----------+----------+----------+---------+------+---------+------+--------------------+-------------+-------------------+
only showing top 20 rows

>>> province = India.groupBy("province")
>>> province_data=province.agg(sum("confirmed").alias("total_confirmed"),sum("active").alias("total_active"),sum("deaths").alias("total_deaths"),sum("recovered").alias("total_recovered"))
>>> province_data.sort(col("total_confirmed").desc()).show()
+-----------------+---------------+------------+------------+---------------+
|         province|total_confirmed|total_active|total_deaths|total_recovered|
+-----------------+---------------+------------+------------+---------------+
|      Maharashtra|        1942136|       55471|       49666|        1836999|
|        Karnataka|         921938|       10912|       12107|         898919|
|   Andhra Pradesh|         883082|        3070|        7115|         872897|
|       Tamil Nadu|         820712|        8127|       12156|         800429|
|           Kerala|         775852|       65467|        3141|         707244|
|            Delhi|         626872|        5044|       10585|         611243|
|    Uttar Pradesh|         588171|       12858|        8403|         566910|
|      West Bengal|         554975|       10446|        9792|         534737|
|           Odisha|         330309|        2217|        1883|         326209|
|        Rajasthan|         309821|        8491|        2710|         298620|
|        Telangana|         287740|        5106|        1551|         281083|
|     Chhattisgarh|         282368|        9980|        3400|         268988|
|          Haryana|         263068|        2890|        2917|         257261|
|            Bihar|         252857|        4473|        1405|         246979|
|          Gujarat|         247228|        9250|        4318|         233660|
|   Madhya Pradesh|         244026|        8852|        3641|         231533|
|            Assam|         216304|        3120|        1052|         212132|
|           Punjab|         167219|        3361|        5376|         158482|
|Jammu and Kashmir|         121653|        2975|        1886|         116792|
|        Jharkhand|         115529|        1601|        1035|         112893|
+-----------------+---------------+------------+------------+---------------+
only showing top 20 rows



>>> province_data = province_data.withColumn('confirmed_percent', f.col('total_confirmed')/f.sum('total_confirmed').over(Window.partitionBy()))
>>> province_data = province_data.withColumn('active_percent', f.col('total_active')/f.sum('total_active').over(Window.partitionBy()))
>>> province_data = province_data.withColumn('deaths_percent', f.col('total_deaths')/f.sum('total_deaths').over(Window.partitionBy()))
>>> province_data = province_data.withColumn('recovered_percent', f.col('total_recovered')/f.sum('total_recovered').over(Window.partitionBy()))

>>> province_data = province_data.withColumn('confirmed_percent',f.col('confirmed_percent')*100)
>>> province_data = province_data.withColumn('active_percent',f.col('active_percent')*100)
>>> province_data = province_data.withColumn('deaths_percent',f.col('deaths_percent')*100)
>>> province_data = province_data.withColumn('recovered_percent',f.col('recovered_percent')*100)


>>> province_data.sort(col("confirmed_percent").desc()).show()
+-----------------+---------------+------------+------------+---------------+------------------+------------------+------------------+------------------+
|         province|total_confirmed|total_active|total_deaths|total_recovered| confirmed_percent|    active_percent|    deaths_percent| recovered_percent|
+-----------------+---------------+------------+------------+---------------+------------------+------------------+------------------+------------------+
|      Maharashtra|        1942136|       55471|       49666|        1836999| 18.78189470903109|  22.7383963304407| 33.18832735267192|18.468116644165445|
|        Karnataka|         921938|       10912|       12107|         898919| 8.915823837390741| 4.472992748603215| 8.090264552385916| 9.037207394046789|
|   Andhra Pradesh|         883082|        3070|        7115|         872897| 8.540057515766451|1.2584391255692695| 4.754458766847757| 8.775597381567483|
|       Tamil Nadu|         820712|        8127|       12156|         800429| 7.936893384623077|3.3313794050493333| 8.123007838341719| 8.047046371485614|
|           Kerala|         775852|       65467|        3141|         707244| 7.503063932593386| 26.83590691649621| 2.098911452799551| 7.110218725152352|
|            Delhi|         626872|        5044|       10585|         611243| 6.062316902647259|2.0676113841600636|  7.07321799677913| 6.145080657055131|
|    Uttar Pradesh|         588171|       12858|        8403|         566910|  5.68804954591518| 5.270687386504778| 5.615139426257442| 5.699382529192358|
|      West Bengal|         554975|       10446|        9792|         534737| 5.367019619709706| 4.281972347132439| 6.543311348555621| 5.375933949855768|
|           Odisha|         330309|        2217|        1883|         326209| 3.194332868267387|0.9087816095723357| 1.258277703158725| 3.279515047300823|
|        Rajasthan|         309821|        8491|        2710|         298620| 2.996198721740764|3.4805884740093376| 1.810904182453608|3.0021513306652237|
|        Telangana|         287740|        5106|        1551|         281083|2.7826590844187047| 2.093026115686218| 1.036425235050017| 2.825844559900117|
|     Chhattisgarh|         282368|        9980|        3400|         268988| 2.730707862477031| 4.090951945661665| 2.271983107137368|2.7042484834672065|
|          Haryana|         263068|        2890|        2917|         257261| 2.544062556543615| 1.184654421138498|1.9492278598587363|2.5863520644239033|
|            Bihar|         252857|        4473|        1405|         246979|2.4453146177412264|1.8335499051046718|0.9388636075082359| 2.482982832684905|
|          Gujarat|         247228|        9250|        4318|         233660|2.3908780153008533|3.7917139776924245|2.8854185460644577|2.3490813740648187|
|   Madhya Pradesh|         244026|        8852|        3641|         231533|2.3599123018501382| 3.628567797895496|  2.43302661561387| 2.327697756489556|
|            Assam|         216304|        3120|        1052|         212132|2.0918200131928253|1.2789348768000393|0.7029783025613268|2.1326514167727386|
|           Punjab|         167219|        3361|        5376|         158482|1.6171316794238249|1.3777243977323501|3.5924062305795563|1.5932856044018684|
|Jammu and Kashmir|         121653|        2975|        1886|         116792|1.1764746840786429|1.2194971982308067|1.2602823941356107| 1.174158657193265|
|        Jharkhand|         115529|        1601|        1035|         112893|1.1172510647244336| 0.656273954409251|  0.69161838702564|1.1349603850136933|
+-----------------+---------------+------------+------------+---------------+------------------+------------------+------------------+------------------+
only showing top 20 rows

>>> province_data.sort(col("active_percent").desc()).show()
+-----------------+---------------+------------+------------+---------------+------------------+------------------+------------------+------------------+
|         province|total_confirmed|total_active|total_deaths|total_recovered| confirmed_percent|    active_percent|    deaths_percent| recovered_percent|
+-----------------+---------------+------------+------------+---------------+------------------+------------------+------------------+------------------+
|           Kerala|         775852|       65467|        3141|         707244| 7.503063932593386| 26.83590691649621| 2.098911452799551| 7.110218725152352|
|      Maharashtra|        1942136|       55471|       49666|        1836999| 18.78189470903109|  22.7383963304407| 33.18832735267192|18.468116644165445|
|    Uttar Pradesh|         588171|       12858|        8403|         566910|  5.68804954591518| 5.270687386504778| 5.615139426257442| 5.699382529192358|
|        Karnataka|         921938|       10912|       12107|         898919| 8.915823837390741| 4.472992748603215| 8.090264552385916| 9.037207394046789|
|      West Bengal|         554975|       10446|        9792|         534737| 5.367019619709706| 4.281972347132439| 6.543311348555621| 5.375933949855768|
|     Chhattisgarh|         282368|        9980|        3400|         268988| 2.730707862477031| 4.090951945661665| 2.271983107137368|2.7042484834672065|
|          Gujarat|         247228|        9250|        4318|         233660|2.3908780153008533|3.7917139776924245|2.8854185460644577|2.3490813740648187|
|   Madhya Pradesh|         244026|        8852|        3641|         231533|2.3599123018501382| 3.628567797895496|  2.43302661561387| 2.327697756489556|
|        Rajasthan|         309821|        8491|        2710|         298620| 2.996198721740764|3.4805884740093376| 1.810904182453608|3.0021513306652237|
|       Tamil Nadu|         820712|        8127|       12156|         800429| 7.936893384623077|3.3313794050493333| 8.123007838341719| 8.047046371485614|
|        Telangana|         287740|        5106|        1551|         281083|2.7826590844187047| 2.093026115686218| 1.036425235050017| 2.825844559900117|
|            Delhi|         626872|        5044|       10585|         611243| 6.062316902647259|2.0676113841600636|  7.07321799677913| 6.145080657055131|
|            Bihar|         252857|        4473|        1405|         246979|2.4453146177412264|1.8335499051046718|0.9388636075082359| 2.482982832684905|
|      Uttarakhand|          91811|        4376|        1527|          85908|0.8878804239923741|1.7937881477169781|1.0203877072349297|0.8636689321371241|
|           Punjab|         167219|        3361|        5376|         158482|1.6171316794238249|1.3777243977323501|3.5924062305795563|1.5932856044018684|
|            Assam|         216304|        3120|        1052|         212132|2.0918200131928253|1.2789348768000393|0.7029783025613268|2.1326514167727386|
|   Andhra Pradesh|         883082|        3070|        7115|         872897| 8.540057515766451|1.2584391255692695| 4.754458766847757| 8.775597381567483|
|Jammu and Kashmir|         121653|        2975|        1886|         116792|1.1764746840786429|1.2194971982308067|1.2602823941356107| 1.174158657193265|
|          Haryana|         263068|        2890|        2917|         257261| 2.544062556543615| 1.184654421138498|1.9492278598587363|2.5863520644239033|
|           Odisha|         330309|        2217|        1883|         326209| 3.194332868267387|0.9087816095723357| 1.258277703158725| 3.279515047300823|
+-----------------+---------------+------------+------------+---------------+------------------+------------------+------------------+------------------+
only showing top 20 rows

>>> province_data.sort(col("deaths_percent").desc()).show()
+-----------------+---------------+------------+------------+---------------+------------------+------------------+------------------+------------------+
|         province|total_confirmed|total_active|total_deaths|total_recovered| confirmed_percent|    active_percent|    deaths_percent| recovered_percent|
+-----------------+---------------+------------+------------+---------------+------------------+------------------+------------------+------------------+
|      Maharashtra|        1942136|       55471|       49666|        1836999| 18.78189470903109|  22.7383963304407| 33.18832735267192|18.468116644165445|
|       Tamil Nadu|         820712|        8127|       12156|         800429| 7.936893384623077|3.3313794050493333| 8.123007838341719| 8.047046371485614|
|        Karnataka|         921938|       10912|       12107|         898919| 8.915823837390741| 4.472992748603215| 8.090264552385916| 9.037207394046789|
|            Delhi|         626872|        5044|       10585|         611243| 6.062316902647259|2.0676113841600636|  7.07321799677913| 6.145080657055131|
|      West Bengal|         554975|       10446|        9792|         534737| 5.367019619709706| 4.281972347132439| 6.543311348555621| 5.375933949855768|
|    Uttar Pradesh|         588171|       12858|        8403|         566910|  5.68804954591518| 5.270687386504778| 5.615139426257442| 5.699382529192358|
|   Andhra Pradesh|         883082|        3070|        7115|         872897| 8.540057515766451|1.2584391255692695| 4.754458766847757| 8.775597381567483|
|           Punjab|         167219|        3361|        5376|         158482|1.6171316794238249|1.3777243977323501|3.5924062305795563|1.5932856044018684|
|          Gujarat|         247228|        9250|        4318|         233660|2.3908780153008533|3.7917139776924245|2.8854185460644577|2.3490813740648187|
|   Madhya Pradesh|         244026|        8852|        3641|         231533|2.3599123018501382| 3.628567797895496|  2.43302661561387| 2.327697756489556|
|     Chhattisgarh|         282368|        9980|        3400|         268988| 2.730707862477031| 4.090951945661665| 2.271983107137368|2.7042484834672065|
|           Kerala|         775852|       65467|        3141|         707244| 7.503063932593386| 26.83590691649621| 2.098911452799551| 7.110218725152352|
|          Haryana|         263068|        2890|        2917|         257261| 2.544062556543615| 1.184654421138498|1.9492278598587363|2.5863520644239033|
|        Rajasthan|         309821|        8491|        2710|         298620| 2.996198721740764|3.4805884740093376| 1.810904182453608|3.0021513306652237|
|Jammu and Kashmir|         121653|        2975|        1886|         116792|1.1764746840786429|1.2194971982308067|1.2602823941356107| 1.174158657193265|
|           Odisha|         330309|        2217|        1883|         326209| 3.194332868267387|0.9087816095723357| 1.258277703158725| 3.279515047300823|
|        Telangana|         287740|        5106|        1551|         281083|2.7826590844187047| 2.093026115686218| 1.036425235050017| 2.825844559900117|
|      Uttarakhand|          91811|        4376|        1527|          85908|0.8878804239923741|1.7937881477169781|1.0203877072349297|0.8636689321371241|
|            Bihar|         252857|        4473|        1405|         246979|2.4453146177412264|1.8335499051046718|0.9388636075082359| 2.482982832684905|
|            Assam|         216304|        3120|        1052|         212132|2.0918200131928253|1.2789348768000393|0.7029783025613268|2.1326514167727386|
+-----------------+---------------+------------+------------+---------------+------------------+------------------+------------------+------------------+
only showing top 20 rows

>>> province_data.sort(col("recovered_percent").desc()).show()
+-----------------+---------------+------------+------------+---------------+------------------+------------------+------------------+------------------+
|         province|total_confirmed|total_active|total_deaths|total_recovered| confirmed_percent|    active_percent|    deaths_percent| recovered_percent|
+-----------------+---------------+------------+------------+---------------+------------------+------------------+------------------+------------------+
|      Maharashtra|        1942136|       55471|       49666|        1836999| 18.78189470903109|  22.7383963304407| 33.18832735267192|18.468116644165445|
|        Karnataka|         921938|       10912|       12107|         898919| 8.915823837390741| 4.472992748603215| 8.090264552385916| 9.037207394046789|
|   Andhra Pradesh|         883082|        3070|        7115|         872897| 8.540057515766451|1.2584391255692695| 4.754458766847757| 8.775597381567483|
|       Tamil Nadu|         820712|        8127|       12156|         800429| 7.936893384623077|3.3313794050493333| 8.123007838341719| 8.047046371485614|
|           Kerala|         775852|       65467|        3141|         707244| 7.503063932593386| 26.83590691649621| 2.098911452799551| 7.110218725152352|
|            Delhi|         626872|        5044|       10585|         611243| 6.062316902647259|2.0676113841600636|  7.07321799677913| 6.145080657055131|
|    Uttar Pradesh|         588171|       12858|        8403|         566910|  5.68804954591518| 5.270687386504778| 5.615139426257442| 5.699382529192358|
|      West Bengal|         554975|       10446|        9792|         534737| 5.367019619709706| 4.281972347132439| 6.543311348555621| 5.375933949855768|
|           Odisha|         330309|        2217|        1883|         326209| 3.194332868267387|0.9087816095723357| 1.258277703158725| 3.279515047300823|
|        Rajasthan|         309821|        8491|        2710|         298620| 2.996198721740764|3.4805884740093376| 1.810904182453608|3.0021513306652237|
|        Telangana|         287740|        5106|        1551|         281083|2.7826590844187047| 2.093026115686218| 1.036425235050017| 2.825844559900117|
|     Chhattisgarh|         282368|        9980|        3400|         268988| 2.730707862477031| 4.090951945661665| 2.271983107137368|2.7042484834672065|
|          Haryana|         263068|        2890|        2917|         257261| 2.544062556543615| 1.184654421138498|1.9492278598587363|2.5863520644239033|
|            Bihar|         252857|        4473|        1405|         246979|2.4453146177412264|1.8335499051046718|0.9388636075082359| 2.482982832684905|
|          Gujarat|         247228|        9250|        4318|         233660|2.3908780153008533|3.7917139776924245|2.8854185460644577|2.3490813740648187|
|   Madhya Pradesh|         244026|        8852|        3641|         231533|2.3599123018501382| 3.628567797895496|  2.43302661561387| 2.327697756489556|
|            Assam|         216304|        3120|        1052|         212132|2.0918200131928253|1.2789348768000393|0.7029783025613268|2.1326514167727386|
|           Punjab|         167219|        3361|        5376|         158482|1.6171316794238249|1.3777243977323501|3.5924062305795563|1.5932856044018684|
|Jammu and Kashmir|         121653|        2975|        1886|         116792|1.1764746840786429|1.2194971982308067|1.2602823941356107| 1.174158657193265|
|        Jharkhand|         115529|        1601|        1035|         112893|1.1172510647244336| 0.656273954409251|  0.69161838702564|1.1349603850136933|
+-----------------+---------------+------------+------------+---------------+------------------+------------------+------------------+------------------+
only showing top 20 rows

//Maximum cases registered in each country 

>>> max_cases = covid_data.groupBy(col('country')).agg(max(col('confirmed')).alias(('Max_Cases'))).orderBy(desc('Max_Cases'))
>>> max_cases.show()
+--------------+---------+
|       country|Max_Cases|
+--------------+---------+
|        France|  2651893|
|United Kingdom|  2286803|
|        Turkey|  2241912|
|         India|  1942136|
|     Argentina|  1640718|
|        Brazil|  1471422|
|        Poland|  1318562|
|          Iran|  1243434|
|  South Africa|  1100748|
|        Russia|   824979|
|            US|   818698|
|     Indonesia|   765350|
|       Czechia|   740481|
|       Romania|   640429|
|          Iraq|   597774|
|    Bangladesh|   516019|
|         Italy|   485070|
|      Colombia|   480219|
|   Philippines|   477807|
|   Switzerland|   452296|
+--------------+---------+
only showing top 20 rows

//Rank Based On Maximum Cases
>>> max_rank =  max_cases.withColumn("RankBasedOnMaxCases",dense_rank().over(Window.orderBy(desc("Max_Cases"))))
>>> max_rank.show()
+--------------+---------+-------------------+
|       country|Max_Cases|RankBasedOnMaxCases|
+--------------+---------+-------------------+
|        France|  2651893|                  1|
|United Kingdom|  2286803|                  2|
|        Turkey|  2241912|                  3|
|         India|  1942136|                  4|
|     Argentina|  1640718|                  5|
|        Brazil|  1471422|                  6|
|        Poland|  1318562|                  7|
|          Iran|  1243434|                  8|
|  South Africa|  1100748|                  9|
|        Russia|   824979|                 10|
|            US|   818698|                 11|
|     Indonesia|   765350|                 12|
|       Czechia|   740481|                 13|
|       Romania|   640429|                 14|
|          Iraq|   597774|                 15|
|    Bangladesh|   516019|                 16|
|         Italy|   485070|                 17|
|      Colombia|   480219|                 18|
|   Philippines|   477807|                 19|
|   Switzerland|   452296|                 20|
+--------------+---------+-------------------+
only showing top 20 rows

//•	Which country has the max no. of cases

>>> max_rank.select('*').where(col('RankBasedOnMaxCases')==1).show()
+-------+---------+-------------------+
|country|Max_Cases|RankBasedOnMaxCases|
+-------+---------+-------------------+
| France|  2651893|                  1|
+-------+---------+-------------------+

//•	List the top 5 countries

>>> max_rank.select('*').where(col("RankBasedOnMaxCases")<=5).show()
+--------------+---------+-------------------+
|       country|Max_Cases|RankBasedOnMaxCases|
+--------------+---------+-------------------+
|        France|  2651893|                  1|
|United Kingdom|  2286803|                  2|
|        Turkey|  2241912|                  3|
|         India|  1942136|                  4|
|     Argentina|  1640718|                  5|
+--------------+---------+-------------------+


//•	Maximum no. of entires

>>> mne = covid_data.groupBy(col('country')).agg(count(col('confirmed')).alias(('Max_Count'))).orderBy(desc('Max_Count'))
>>> mne_rank =  mne.withColumn("RankBasedOnMaxCases",dense_rank().over(Window.orderBy(desc("Max_Count"))))
>>> mne_rank.show()
+--------------+---------+-------------------+
|       country|Max_Count|RankBasedOnMaxCases|
+--------------+---------+-------------------+
|            US|     3276|                  1|
|        Russia|       83|                  2|
|         Japan|       49|                  3|
|         India|       37|                  4|
|         China|       34|                  5|
|      Colombia|       34|                  5|
|        Mexico|       33|                  6|
|       Ukraine|       27|                  7|
|        Brazil|       27|                  7|
|          Peru|       26|                  8|
|        Sweden|       21|                  9|
|         Italy|       21|                  9|
|         Spain|       20|                 10|
|      Malaysia|       17|                 11|
|       Germany|       17|                 11|
|         Chile|       17|                 11|
|   Netherlands|       17|                 11|
|        Canada|       16|                 12|
|United Kingdom|       16|                 12|
|        France|       12|                 13|
+--------------+---------+-------------------+
only showing top 20 rows


//States with max/min deaths among identified confirmed covid19 cases
>>> covid_data.filter(col("country")=="India").groupBy("province").max("Case_Fatality_Ratio").withColumnRenamed("max(Case_Fatality_Ratio)","Fatality_Ratio").orderBy("Fatality_Ratio",ascending=False).show()
+--------------------+--------------+
|            province|Fatality_Ratio|
+--------------------+--------------+
|              Punjab|    3.21494567|
|         Maharashtra|    2.55728744|
|              Sikkim|   2.179054054|
|         West Bengal|   1.764403802|
|             Gujarat|   1.746565923|
|    Himachal Pradesh|   1.695219624|
|               Delhi|   1.688542478|
|         Uttarakhand|   1.663199399|
|          Puducherry|   1.656027627|
|          Chandigarh|   1.609576983|
|   Jammu and Kashmir|   1.550311131|
|      Madhya Pradesh|   1.492054125|
|          Tamil Nadu|    1.48115295|
|                 Goa|   1.444585242|
|       Uttar Pradesh|   1.428666153|
|              Ladakh|   1.329007953|
|           Karnataka|   1.313211951|
|             Manipur|   1.265867544|
|Andaman and Nicob...|   1.253031528|
|        Chhattisgarh|   1.204102448|
+--------------------+--------------+
only showing top 20 rows

>>> covid_data.groupBy("country").max("Case_Fatality_Ratio").withColumnRenamed("max(Case_Fatality_Ratio)","Fatality_Ratio").orderBy("Fatality_Ratio",ascending=False).show()
+--------------+--------------+
|       country|Fatality_Ratio|
+--------------+--------------+
|            US|   262.8571429|
|       Belgium|   183.4870075|
|         Yemen|   29.03379343|
|    MS Zaandam|   22.22222222|
|        Mexico|   15.88356765|
|United Kingdom|   7.692307692|
|         China|   6.620786805|
|          Peru|   6.620608712|
|       Ecuador|   6.550830794|
|         Sudan|   6.296105679|
|         Syria|   6.225448335|
|         Japan|   6.091370558|
|        Brazil|   5.878748517|
|      Colombia|   5.664003237|
|       Bolivia|   5.656549511|
|     Australia|   5.555555556|
|         Egypt|   5.489250072|
|         Italy|   5.264593562|
|         Spain|   4.942769865|
|        Russia|   4.728685409|
+--------------+--------------+
only showing top 20 rows



>>> covid_data.filter(col("country")=="India").groupBy("province").max("Incident_Rate").withColumnRenamed("max(Incident_Rate)","Incident_Rate").orderBy("Incident_Rate",ascending=False).show()
+--------------------+-------------+
|            province|Incident_Rate|
+--------------------+-------------+
|              Ladakh|  3483.916599|
|               Delhi|  3350.299894|
|                 Goa|  3233.727344|
|          Puducherry|   2704.12906|
|              Kerala|   2173.28881|
|          Chandigarh|  1716.138399|
|      Andhra Pradesh|  1638.267929|
|         Maharashtra|   1577.12311|
|           Karnataka|  1364.566826|
|Andaman and Nicob...|  1186.468314|
|   Arunachal Pradesh|   1065.42168|
|          Tamil Nadu|  1054.340495|
|        Chhattisgarh|  959.2532414|
|             Haryana|  932.7100611|
|             Manipur|  914.7853258|
|   Jammu and Kashmir|  894.0918632|
|              Sikkim|  857.6590255|
|         Uttarakhand|  816.0355415|
|             Tripura|  798.1929083|
|    Himachal Pradesh|  747.2669924|
+--------------------+-------------+
only showing top 20 rows

>>> covid_data.groupBy("country").max("Incident_Rate").withColumnRenamed("max(Incident_Rate)","Incident_Rate").orderBy("Incident_Rate",ascending=False).show()
+--------------+-------------+
|       country|Incident_Rate|
+--------------+-------------+
|            US|  27388.21977|
|        Brazil|  11369.99576|
|       Andorra|  10602.47201|
|         Chile|  10293.45535|
|       Belgium|  8776.395855|
|          Peru|  8375.194603|
|    Montenegro|  7832.825422|
|    Luxembourg|  7414.821016|
|    San Marino|  7154.222406|
|United Kingdom|  7141.373067|
|       Czechia|  6914.578809|
|        Russia|  6596.418749|
|         Spain|  6538.081625|
|      Colombia|  6478.444846|
|        France|  6025.546094|
|      Slovenia|  6016.839416|
|        Panama|  5880.640628|
|         Italy|  5834.513711|
| Liechtenstein|   5826.36285|
|       Georgia|  5744.771789|
+--------------+-------------+
only showing top 20 rows


>>> dates = covid_data.filter(col("country")=="India").groupBy("date")
>>> total_dates_sum=dates.agg(sum("confirmed").alias("total_confirmed"),sum("active").alias("total_active"),sum("deaths").alias("total_deaths"),sum("recovered").alias("total_recovered"))
>>> total_dates_sum.show(total_dates_sum.count(),False)
+----------+---------------+------------+------------+---------------+
|date      |total_confirmed|total_active|total_deaths|total_recovered|
+----------+---------------+------------+------------+---------------+
|04-01-2021|10340469       |243953      |149649      |9946867        |
+----------+---------------+------------+------------+---------------+

>>> total_dates_sum.show(total_dates_sum.count(),False)
+----------+----------------------------------------+---------------+------------+------------+---------------+
|date      |province                                |total_confirmed|total_active|total_deaths|total_recovered|
+----------+----------------------------------------+---------------+------------+------------+---------------+
|04-01-2021|Chandigarh                              |19881          |281         |320         |19280          |
|04-01-2021|Ladakh                                  |9556           |256         |127         |9173           |
|04-01-2021|Meghalaya                               |13460          |135         |139         |13186          |
|04-01-2021|Tripura                                 |33283          |83          |385         |32815          |
|04-01-2021|Chhattisgarh                            |282368         |9980        |3400        |268988         |
|04-01-2021|Gujarat                                 |247228         |9250        |4318        |233660         |
|04-01-2021|Uttar Pradesh                           |588171         |12858       |8403        |566910         |
|04-01-2021|Punjab                                  |167219         |3361        |5376        |158482         |
|04-01-2021|Manipur                                 |28281          |1108        |358         |26815          |
|04-01-2021|West Bengal                             |554975         |10446       |9792        |534737         |
|04-01-2021|Nagaland                                |11930          |178         |79          |11673          |
|04-01-2021|Assam                                   |216304         |3120        |1052        |212132         |
|04-01-2021|Jammu and Kashmir                       |121653         |2975        |1886        |116792         |
|04-01-2021|Puducherry                              |38224          |358         |633         |37233          |
|04-01-2021|Delhi                                   |626872         |5044        |10585       |611243         |
|04-01-2021|Uttarakhand                             |91811          |4376        |1527        |85908          |
|04-01-2021|Telangana                               |287740         |5106        |1551        |281083         |
|04-01-2021|Odisha                                  |330309         |2217        |1883        |326209         |
|04-01-2021|Lakshadweep                             |0              |0           |0           |0              |
|04-01-2021|Sikkim                                  |5920           |506         |129         |5285           |
|04-01-2021|Rajasthan                               |309821         |8491        |2710        |298620         |
|04-01-2021|Maharashtra                             |1942136        |55471       |49666       |1836999        |
|04-01-2021|Karnataka                               |921938         |10912       |12107       |898919         |
|04-01-2021|Goa                                     |51295          |901         |741         |49653          |
|04-01-2021|Andhra Pradesh                          |883082         |3070        |7115        |872897         |
|04-01-2021|Madhya Pradesh                          |244026         |8852        |3641        |231533         |
|04-01-2021|Kerala                                  |775852         |65467       |3141        |707244         |
|04-01-2021|Himachal Pradesh                        |55686          |1830        |944         |52912          |
|04-01-2021|Andaman and Nicobar Islands             |4948           |40          |62          |4846           |
|04-01-2021|Arunachal Pradesh                       |16732          |93          |56          |16583          |
|04-01-2021|Mizoram                                 |4223           |88          |8           |4127           |
|04-01-2021|Dadra and Nagar Haveli and Daman and Diu|3379           |9           |2           |3368           |
|04-01-2021|Tamil Nadu                              |820712         |8127        |12156       |800429         |
|04-01-2021|Bihar                                   |252857         |4473        |1405        |246979         |
|04-01-2021|Haryana                                 |263068         |2890        |2917        |257261         |
|04-01-2021|Jharkhand                               |115529         |1601        |1035        |112893         |
+----------+----------------------------------------+---------------+------------+------------+---------------+


>>> abc = covid_data.filter(col("country")=="India").filter(col("date")=="04-01-2021").groupBy("province")
>>> abcd = abc.agg(sum("confirmed").alias("total_confirmed"),sum("active").alias("total_active"),sum("deaths").alias("total_deaths"),sum("recovered").alias("total_recovered"))
>>> abcd.show()
+--------------------+---------------+------------+------------+---------------+
|            province|total_confirmed|total_active|total_deaths|total_recovered|
+--------------------+---------------+------------+------------+---------------+
|            Nagaland|          11930|         178|          79|          11673|
|           Karnataka|         921938|       10912|       12107|         898919|
|              Odisha|         330309|        2217|        1883|         326209|
|              Kerala|         775852|       65467|        3141|         707244|
|Dadra and Nagar H...|           3379|           9|           2|           3368|
|              Ladakh|           9556|         256|         127|           9173|
|          Tamil Nadu|         820712|        8127|       12156|         800429|
|        Chhattisgarh|         282368|        9980|        3400|         268988|
|      Andhra Pradesh|         883082|        3070|        7115|         872897|
|         Lakshadweep|              0|           0|           0|              0|
|      Madhya Pradesh|         244026|        8852|        3641|         231533|
|              Punjab|         167219|        3361|        5376|         158482|
|             Manipur|          28281|        1108|         358|          26815|
|                 Goa|          51295|         901|         741|          49653|
|             Mizoram|           4223|          88|           8|           4127|
|    Himachal Pradesh|          55686|        1830|         944|          52912|
|          Puducherry|          38224|         358|         633|          37233|
|             Haryana|         263068|        2890|        2917|         257261|
|   Jammu and Kashmir|         121653|        2975|        1886|         116792|
|           Jharkhand|         115529|        1601|        1035|         112893|
+--------------------+---------------+------------+------------+---------------+
only showing top 20 rows


>>> abcde = covid_dataa.filter(col("country")=="India").filter(col("reportdate")=="04-01-2021").groupBy("countyname")
>>> abcdef = abcde.agg(sum("newpositive").alias("total_positive"),sum("death").alias("total_deaths"))
>>> abcdef.show()
+----------+--------------+------------+
|countyname|total_positive|total_deaths|
+----------+--------------+------------+
|      null|         16375|         201|
+----------+--------------+------------+

>>> abcde = covid_dataa.filter(col("country")=="India").filter(col("reportdate")=="11-05-2021").groupBy("countyname")
>>> abcdef = abcde.agg(sum("newpositive").alias("total_positive"),sum("death").alias("total_deaths"))
>>> abcdef.show()
+----------+--------------+------------+
|countyname|total_positive|total_deaths|
+----------+--------------+------------+
|      null|        348421|        4205|
+----------+--------------+------------+


>>> death_filter = covid_data.filter(col('deaths')>1000)
>>> death_filter.sort(col("deaths").desc()).show()
+----------------+--------------+----------+-----------+-----------+---------+------+---------+-------+--------------------+-------------+-------------------+
|        province|       country|      date|        lat|       long|confirmed|deaths|recovered| active|        Combined_Key|Incident_Rate|Case_Fatality_Ratio|
+----------------+--------------+----------+-----------+-----------+---------+------+---------+-------+--------------------+-------------+-------------------+
|         England|United Kingdom|04-01-2021|    52.3555|    -1.1743|  2286803| 65472|        0|2221331|England, United K...|  4085.240062|          2.8630363|
|            null|        France|04-01-2021|    46.2276|     2.2137|  2651893| 64671|   171381|2415841|              France|  4062.739875|        2.438673054|
|            null|          Iran|04-01-2021|  32.427908|  53.688046|  1243434| 55540|  1013018| 174876|                Iran|  1480.402767|        4.466662485|
|     Maharashtra|         India|04-01-2021|  19.449759|  76.108221|  1942136| 49666|  1836999|  55471|  Maharashtra, India|   1577.12311|         2.55728744|
|       Sao Paulo|        Brazil|04-01-2021|   -23.5505|   -46.6333|  1471422| 46845|  1294620| 129957|   Sao Paulo, Brazil|  3204.382565|        3.183654995|
|            null|     Argentina|04-01-2021|   -38.4161|   -63.6167|  1640718| 43482|  1452960| 144276|           Argentina|  3630.246251|        2.650181201|
|            Lima|          Peru|04-01-2021| -11.766533| -76.604498|   450835| 42312|        0| 434025|          Lima, Peru|  4241.755657|        3.728636863|
|            null|  South Africa|04-01-2021|   -30.5595|    22.9375|  1100748| 29577|   903679| 167492|        South Africa|  1855.964109|        2.686991028|
|            null|        Poland|04-01-2021|    51.9194|    19.1451|  1318562| 29119|  1063093| 226350|              Poland|  3483.963753|        2.208390656|
|  Rio de Janeiro|        Brazil|04-01-2021|   -22.9068|   -43.1729|   435739| 25616|   406061|   4062|Rio de Janeiro, B...|  2523.836887|        5.878748517|
|       Lombardia|         Italy|04-01-2021|45.46679409|9.190347404|   485070| 25317|   402798|  56955|    Lombardia, Italy|  4821.494281|        5.219246707|
|            null|     Indonesia|04-01-2021|    -0.7893|   113.9213|   765350| 22734|   631937| 110679|           Indonesia|  279.8113001|        2.970405697|
|            null|        Turkey|04-01-2021|    38.9637|    35.2433|  2241912| 21488|  2136534|  83890|              Turkey|  2658.212949|        0.958467594|
|          Mexico|        Mexico|04-01-2021|    19.4969|   -99.7233|   148276| 19138|        0| 129138|      Mexico, Mexico|   850.802081|        12.90701125|
|Ciudad de Mexico|        Mexico|04-01-2021|    19.4326|   -99.1332|   337068| 17028|        0| 320040|Ciudad de Mexico,...|  3737.457234|        5.051799637|
|            null|       Romania|04-01-2021|    45.9432|    24.9668|   640429| 15979|   574897|  49553|             Romania|  3329.034132|        2.495046289|
|            null|       Ecuador|04-01-2021|    -1.8312|   -78.1834|   214614| 14059|   190350|  10205|             Ecuador|  1216.421641|        6.550830794|
|            null|          Iraq|04-01-2021|  33.223191|  43.679291|   597774| 12834|   543720|  41220|                Iraq|  1486.168079|        2.146965241|
|      Tamil Nadu|         India|04-01-2021|  11.006091|  78.400624|   820712| 12156|   800429|   8127|   Tamil Nadu, India|  1054.340495|         1.48115295|
|       Karnataka|         India|04-01-2021|   14.70518|  76.166436|   921938| 12107|   898919|  10912|    Karnataka, India|  1364.566826|        1.313211951|
+----------------+--------------+----------+-----------+-----------+---------+------+---------+-------+--------------------+-------------+-------------------+
only showing top 20 rows

>>> confirmed_filter = covid_data.filter(col('confirmed')>1000000)
>>> confirmed_filter.sort(col("confirmed").desc()).show()
+-----------+--------------+----------+---------+---------+---------+------+---------+-------+--------------------+-------------+-------------------+
|   province|       country|      date|      lat|     long|confirmed|deaths|recovered| active|        Combined_Key|Incident_Rate|Case_Fatality_Ratio|
+-----------+--------------+----------+---------+---------+---------+------+---------+-------+--------------------+-------------+-------------------+
|       null|        France|04-01-2021|  46.2276|   2.2137|  2651893| 64671|   171381|2415841|              France|  4062.739875|        2.438673054|
|    England|United Kingdom|04-01-2021|  52.3555|  -1.1743|  2286803| 65472|        0|2221331|England, United K...|  4085.240062|          2.8630363|
|       null|        Turkey|04-01-2021|  38.9637|  35.2433|  2241912| 21488|  2136534|  83890|              Turkey|  2658.212949|        0.958467594|
|Maharashtra|         India|04-01-2021|19.449759|76.108221|  1942136| 49666|  1836999|  55471|  Maharashtra, India|   1577.12311|         2.55728744|
|       null|     Argentina|04-01-2021| -38.4161| -63.6167|  1640718| 43482|  1452960| 144276|           Argentina|  3630.246251|        2.650181201|
|  Sao Paulo|        Brazil|04-01-2021| -23.5505| -46.6333|  1471422| 46845|  1294620| 129957|   Sao Paulo, Brazil|  3204.382565|        3.183654995|
|       null|        Poland|04-01-2021|  51.9194|  19.1451|  1318562| 29119|  1063093| 226350|              Poland|  3483.963753|        2.208390656|
|       null|          Iran|04-01-2021|32.427908|53.688046|  1243434| 55540|  1013018| 174876|                Iran|  1480.402767|        4.466662485|
|       null|  South Africa|04-01-2021| -30.5595|  22.9375|  1100748| 29577|   903679| 167492|        South Africa|  1855.964109|        2.686991028|
+-----------+--------------+----------+---------+---------+---------+------+---------+-------+--------------------+-------------+-------------------+


>>> India = covid_data.filter(col("country")=="India").groupBy("province")
>>> total_provinces_sum=dates.agg(sum("confirmed").alias("total_confirmed"),sum("active").alias("total_active"),sum("deaths").alias("total_deaths"),sum("recovered").alias("total_recovered"))
>>> total_provinces_sum.sort(col("total_confirmed").desc()).show()
+-----------------+---------------+------------+------------+---------------+
|         province|total_confirmed|total_active|total_deaths|total_recovered|
+-----------------+---------------+------------+------------+---------------+
|      Maharashtra|        1942136|       55471|       49666|        1836999|
|        Karnataka|         921938|       10912|       12107|         898919|
|   Andhra Pradesh|         883082|        3070|        7115|         872897|
|       Tamil Nadu|         820712|        8127|       12156|         800429|
|           Kerala|         775852|       65467|        3141|         707244|
|            Delhi|         626872|        5044|       10585|         611243|
|    Uttar Pradesh|         588171|       12858|        8403|         566910|
|      West Bengal|         554975|       10446|        9792|         534737|
|           Odisha|         330309|        2217|        1883|         326209|
|        Rajasthan|         309821|        8491|        2710|         298620|
|        Telangana|         287740|        5106|        1551|         281083|
|     Chhattisgarh|         282368|        9980|        3400|         268988|
|          Haryana|         263068|        2890|        2917|         257261|
|            Bihar|         252857|        4473|        1405|         246979|
|          Gujarat|         247228|        9250|        4318|         233660|
|   Madhya Pradesh|         244026|        8852|        3641|         231533|
|            Assam|         216304|        3120|        1052|         212132|
|           Punjab|         167219|        3361|        5376|         158482|
|Jammu and Kashmir|         121653|        2975|        1886|         116792|
|        Jharkhand|         115529|        1601|        1035|         112893|
+-----------------+---------------+------------+------------+---------------+
only showing top 20 rows

